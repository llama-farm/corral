<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Integration ‚Äî Corral Agent-Native Auth + Payments</title>
  <meta name="description" content="How AI coding agents (OpenClaw, Claude Code, Codex, Cursor, Windsurf) use Corral to add agent-native auth + payments to any app. llms.txt, CORRAL.md, --json CLI, example prompts, full workflow.">
  <meta property="og:title" content="Corral for AI Agents ‚Äî Auth + Payments in One Conversation">
  <meta property="og:description" content="Point your AI coding agent at Corral. It reads llms.txt, runs the CLI, and adds login, Stripe billing, and feature gating to your app. Works with OpenClaw, Claude Code, Codex, Cursor, and more.">
  <link rel="stylesheet" href="css/style.css">
  <style>
    .agent-row {
      display: grid;
      grid-template-columns: 180px 1fr;
      gap: 0;
      border: 1px solid var(--bg-border);
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 24px;
    }
    .agent-row-header {
      background: var(--bg-card);
      padding: 20px;
      border-right: 1px solid var(--bg-border);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-align: center;
    }
    .agent-row-name {
      font-weight: 700;
      font-size: 1rem;
      color: var(--text);
    }
    .agent-row-tag {
      font-size: 0.72rem;
      padding: 2px 8px;
      background: rgba(99,102,241,0.15);
      color: #a5b4fc;
      border-radius: 10px;
    }
    .agent-row-body {
      padding: 20px 24px;
    }
    .agent-row-body h4 {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 10px;
    }
    .agent-row-body .prompt-box {
      background: #0d1117;
      border: 1px solid var(--bg-border);
      border-radius: 6px;
      padding: 12px 16px;
      font-family: var(--font-mono);
      font-size: 0.83rem;
      color: #f9a8d4;
      margin-bottom: 12px;
      white-space: pre-wrap;
    }
    .agent-row-body .context-box {
      background: #0d1117;
      border: 1px solid var(--bg-border);
      border-radius: 6px;
      padding: 10px 14px;
      font-family: var(--font-mono);
      font-size: 0.8rem;
      color: #93c5fd;
      margin-top: 8px;
    }
    .agent-row-body p {
      font-size: 0.88rem;
      color: var(--text-muted);
      line-height: 1.6;
      margin-bottom: 8px;
    }
    @media (max-width: 600px) {
      .agent-row { grid-template-columns: 1fr; }
      .agent-row-header { border-right: none; border-bottom: 1px solid var(--bg-border); flex-direction: row; justify-content: flex-start; padding: 12px 16px; }
    }
    .conversation-block {
      background: #0d1117;
      border: 1px solid var(--bg-border);
      border-radius: 8px;
      padding: 20px 24px;
      font-size: 0.875rem;
      line-height: 1.7;
    }
    .conversation-block .msg { margin-bottom: 12px; }
    .conversation-block .msg-human { color: #f9a8d4; }
    .conversation-block .msg-agent { color: #86efac; }
    .conversation-block .msg-tool  { color: #93c5fd; padding-left: 20px; font-family: var(--font-mono); font-size: 0.8rem; }
    .conversation-block .msg-done  { color: #fde68a; font-weight: 600; }
    .conversation-block .msg-label { font-weight: 700; margin-right: 8px; }
  </style>
</head>
<body class="page-body">

<nav class="top-nav">
  <a href="index.html" class="nav-logo"><span class="logo-emoji">ü¶ô</span> Corral</a>
  <div class="nav-links">
    <a href="quickstart.html">Quickstart</a>
    <a href="concepts.html">Concepts</a>
    <a href="cli.html">CLI</a>
    <a href="frameworks.html">Frameworks</a>
    <a href="billing.html">Billing</a>
    <a href="gating.html">Gating</a>
    <a href="agents.html" class="active">Agents</a>
    <a href="api.html">API</a>
  </div>
  <div class="nav-right">
    <a href="https://github.com/llama-farm/corral" class="nav-github" target="_blank" rel="noopener">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"/></svg>
      GitHub
    </a>
  </div>
</nav>

<div class="docs-layout">
  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-section-title">On This Page</div>
      <ul class="sidebar-nav">
        <li><a href="#overview">Overview</a></li>
        <li><a href="#give-context">Give Your Agent Context</a></li>
        <li><a href="#supported-agents">Supported Agents</a></li>
        <li><a href="#example-prompts">Example Prompts</a></li>
        <li><a href="#example-conversation">Full Conversation</a></li>
        <li><a href="#corral-md">CORRAL.md</a></li>
        <li><a href="#json-output">--json Output</a></li>
        <li><a href="#nine-commands">9-Command Workflow</a></li>
        <li><a href="#idempotent">Idempotency</a></li>
        <li><a href="#mcp">MCP Integration</a></li>
        <li><a href="#design-goals">Design Goals</a></li>
      </ul>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-section-title">Reference</div>
      <ul class="sidebar-nav">
        <li><a href="cli.html">CLI Reference</a></li>
        <li><a href="llms.txt">llms.txt</a></li>
        <li><a href="llms-full.txt">llms-full.txt</a></li>
      </ul>
    </div>
  </aside>

  <main class="docs-content">
    <h1>Agent Integration</h1>
    <p class="docs-lead">
      Corral is built <em>for</em> AI coding agents. Point your agent here, tell it what
      you need, and it adds login, Stripe billing, and feature gating to your app ‚Äî
      in one conversation, with no human touching auth code.
    </p>

    <div class="callout info">
      <div class="callout-title">TL;DR for agents</div>
      Read <a href="llms.txt">llms.txt</a> or <a href="llms-full.txt">llms-full.txt</a>, run
      <code>npx create-corral init</code>, edit <code>corral.yaml</code>, run
      <code>npx create-corral validate</code>. Done. The app has auth + payments.
    </div>

    <!-- ‚îÄ‚îÄ Overview ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <h2 id="overview">Why Corral is Agent-Native</h2>
    <p>
      Auth + billing integration is one of the hardest things for AI agents to get right
      with traditional libraries. Too many files, too many wiring decisions, too much
      tribal knowledge that lives in blog posts rather than docs.
    </p>
    <p>
      Corral solves this by making the entire auth + billing topology declarative:
      one YAML file, one CLI, structured JSON output on every command.
      An agent can read the spec, generate the config, and wire up an entire auth
      stack without ambiguity.
    </p>

    <ul>
      <li><strong>One spec to read</strong> ‚Äî <code>llms.txt</code> or <code>llms-full.txt</code> covers everything</li>
      <li><strong>One config to edit</strong> ‚Äî <code>corral.yaml</code> is the single source of truth</li>
      <li><strong>--json on every command</strong> ‚Äî structured output, numeric exit codes, no screen-scraping</li>
      <li><strong>CORRAL.md after init</strong> ‚Äî project-specific guide the agent reads for subsequent changes</li>
      <li><strong>Idempotent commands</strong> ‚Äî safe to re-run on failure; agents can retry without side effects</li>
      <li><strong>Self-diagnosing errors</strong> ‚Äî every error JSON includes a <code>"fix"</code> field telling the agent exactly what to do</li>
    </ul>

    <!-- ‚îÄ‚îÄ Give Your Agent Context ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <h2 id="give-context">Give Your Agent Corral Context</h2>
    <p>
      Before your agent can use Corral, it needs to know Corral exists and what it does.
      Here are the four ways to give your agent that context, depending on your setup:
    </p>

    <h3>Option 1: Paste the llms.txt URL (any agent)</h3>
    <p>
      The simplest approach. Just include the URL in your prompt:
    </p>
    <div class="code-block">
      <div class="code-block-header"><span class="code-lang">prompt</span></div>
      <pre><code>Read https://corralauth.dev/llms.txt then add auth and Stripe billing to this app.
Free tier and Pro at $29/mo. Use Google login.</code></pre>
    </div>

    <h3>Option 2: Add to AGENTS.md (Claude Code / OpenClaw)</h3>
    <div class="code-block">
      <div class="code-block-header"><span class="code-filename">AGENTS.md</span><span class="code-lang">markdown</span></div>
      <pre><code>## Auth + Payments

This project uses Corral for auth, Stripe billing, and feature gating.
Corral spec: https://corralauth.dev/llms.txt
Full reference: https://corralauth.dev/llms-full.txt

When asked to add auth or payments:
1. Read CORRAL.md (if it exists) for project-specific context
2. Otherwise, run: npx create-corral init
3. Edit corral.yaml with the requested plans/features
4. Run: corral validate --json</code></pre>
    </div>

    <h3>Option 3: Add to .cursorrules (Cursor)</h3>
    <div class="code-block">
      <div class="code-block-header"><span class="code-filename">.cursorrules</span><span class="code-lang">text</span></div>
      <pre><code>## Auth + Payments (Corral)

This project uses Corral for auth + Stripe billing.
Read https://corralauth.dev/llms.txt for the full spec.

- All auth/billing config lives in corral.yaml
- To add a feature gate: corral add feature &lt;name&gt; --plans &lt;list&gt; --gate &lt;mode&gt;
- To add a plan: corral add plan &lt;name&gt; --price &lt;n&gt;
- To sync Stripe: corral stripe push --json
- To validate: corral validate --json (exit 0 = deploy-ready)</code></pre>
    </div>

    <h3>Option 4: OpenClaw Skill (first-class support)</h3>
    <p>
      Corral ships as an OpenClaw skill. When installed, OpenClaw knows Corral's
      full CLI, understands the YAML schema, and can make changes interactively
      as you describe what you want.
    </p>
    <div class="code-block">
      <div class="code-block-header"><span class="code-lang">bash</span></div>
      <pre><code><span class="tok-comment"># Install the Corral skill in OpenClaw</span>
openclaw skill add corral

<span class="tok-comment"># Then just tell OpenClaw what you want:</span>
<span class="tok-comment"># "Add Google auth and a $29/mo Pro plan with AI features gated"</span></code></pre>
    </div>

    <!-- ‚îÄ‚îÄ Supported Agents ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <h2 id="supported-agents">Supported Agents</h2>
    <p>
      Any agent that can run shell commands and read markdown can use Corral.
      Here's how to set up each major agent:
    </p>

    <div class="agent-row">
      <div class="agent-row-header">
        <span style="font-size:1.8rem">ü¶ô</span>
        <div class="agent-row-name">OpenClaw</div>
        <div class="agent-row-tag">First-class</div>
      </div>
      <div class="agent-row-body">
        <p>Native Corral skill. OpenClaw knows the full CLI and YAML schema without needing llms.txt.</p>
        <h4>Setup</h4>
        <div class="context-box">openclaw skill add corral</div>
        <p style="margin-top:8px">Or add to your workspace AGENTS.md ‚Äî OpenClaw reads it on every session.</p>
      </div>
    </div>

    <div class="agent-row">
      <div class="agent-row-header">
        <span style="font-size:1.8rem">ü§ñ</span>
        <div class="agent-row-name">Claude Code</div>
        <div class="agent-row-tag">Excellent</div>
      </div>
      <div class="agent-row-body">
        <p>Point it at llms.txt and it handles everything. Best results with AGENTS.md context.</p>
        <h4>Setup</h4>
        <div class="context-box"># Add to AGENTS.md:
Corral spec: https://corralauth.dev/llms.txt</div>
        <h4>Or in your prompt</h4>
        <div class="context-box">Read https://corralauth.dev/llms.txt then add auth + billing.</div>
      </div>
    </div>

    <div class="agent-row">
      <div class="agent-row-header">
        <span style="font-size:1.8rem">‚ö°</span>
        <div class="agent-row-name">Codex</div>
        <div class="agent-row-tag">Great</div>
      </div>
      <div class="agent-row-body">
        <p>The <code>--json</code> flag on every command makes Codex integration seamless. No output parsing.</p>
        <h4>Setup</h4>
        <div class="context-box"># Add to AGENTS.md or pass in system prompt:
Auth/payments: use Corral (https://corralauth.dev/llms.txt)
Always use --json flag on corral commands.</div>
      </div>
    </div>

    <div class="agent-row">
      <div class="agent-row-header">
        <span style="font-size:1.8rem">üéØ</span>
        <div class="agent-row-name">Cursor</div>
        <div class="agent-row-tag">Great</div>
      </div>
      <div class="agent-row-body">
        <p>Add to <code>.cursorrules</code> for persistent context in every Cursor session on this project.</p>
        <h4>Setup</h4>
        <div class="context-box"># .cursorrules
Auth + payments: Corral. Read https://corralauth.dev/llms.txt
Config: corral.yaml | Validate: corral validate --json</div>
      </div>
    </div>

    <div class="agent-row">
      <div class="agent-row-header">
        <span style="font-size:1.8rem">üåä</span>
        <div class="agent-row-name">Windsurf</div>
        <div class="agent-row-tag">Good</div>
      </div>
      <div class="agent-row-body">
        <p>Add Corral context to Windsurf's project rules or include in your system prompt.</p>
        <h4>Setup</h4>
        <div class="context-box"># Project rules / system prompt:
This project uses Corral for auth + billing.
Spec: https://corralauth.dev/llms.txt</div>
      </div>
    </div>

    <div class="agent-row">
      <div class="agent-row-header">
        <span style="font-size:1.8rem">‚å®Ô∏è</span>
        <div class="agent-row-name">Aider</div>
        <div class="agent-row-tag">Good</div>
      </div>
      <div class="agent-row-body">
        <p>Use <code>/read</code> to add llms.txt or llms-full.txt to Aider's context. Include CORRAL.md after init.</p>
        <h4>Setup</h4>
        <div class="context-box">/read https://corralauth.dev/llms.txt
/read CORRAL.md  # after corral init</div>
      </div>
    </div>

    <div class="agent-row">
      <div class="agent-row-header">
        <span style="font-size:1.8rem">üîß</span>
        <div class="agent-row-name">Any Agent</div>
        <div class="agent-row-tag">Supported</div>
      </div>
      <div class="agent-row-body">
        <p>If it can run CLI commands and read markdown, it can use Corral. Just provide the llms.txt URL.</p>
        <h4>Universal setup</h4>
        <div class="context-box">Read https://corralauth.dev/llms-full.txt for the Corral spec.
All CLI commands support --json. Exit 0 = success, 1 = error.</div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ Example Prompts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <h2 id="example-prompts">Example Prompts</h2>
    <p>
      These are prompts that work well with Corral-aware agents.
      The more specific you are, the better the output.
    </p>

    <h3>Basic auth setup</h3>
    <div class="code-block">
      <div class="code-block-header"><span class="code-lang">prompt</span></div>
      <pre><code>Add user authentication to this app using Corral.
Email magic link + Google OAuth.
After setup, validate with corral validate --json.</code></pre>
    </div>

    <h3>Full SaaS billing</h3>
    <div class="code-block">
      <div class="code-block-header"><span class="code-lang">prompt</span></div>
      <pre><code>Add auth and Stripe billing to this app using Corral.

Plans:
- Free: $0/mo ‚Äî basic features, 500 API calls/month
- Pro: $29/mo ‚Äî all features, 10k API calls/month, 14-day trial

Auth: Google OAuth + email magic link

Gate the "ai_analysis" feature to Pro plan with blur effect.

After setup run corral validate --json and show me the output.</code></pre>
    </div>

    <h3>Adding a feature gate</h3>
    <div class="code-block">
      <div class="code-block-header"><span class="code-lang">prompt</span></div>
      <pre><code>Read CORRAL.md then add a feature gate for "advanced_export".
Available on Pro and Enterprise plans. Use "block" gate mode.
Run corral validate --json when done.</code></pre>
    </div>

    <h3>Adding a new plan</h3>
    <div class="code-block">
      <div class="code-block-header"><span class="code-lang">prompt</span></div>
      <pre><code>Add an "Enterprise" plan to Corral at $199/mo (annual only).
It should include all Pro features plus "sso" and "audit_log".
Sync to Stripe after. Show me the Stripe product IDs.</code></pre>
    </div>

    <!-- ‚îÄ‚îÄ Full Conversation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <h2 id="example-conversation">Full Example Conversation</h2>
    <p>
      Here's what it looks like when a human asks an agent to add auth with
      Google login and a $29/mo Pro plan:
    </p>

    <div class="conversation-block">
      <div class="msg msg-human">
        <span class="msg-label">You:</span>
        Add auth to this Next.js app. I want Google login and email magic links.
        Free tier and Pro at $29/mo. Pro users get access to the AI dashboard feature.
        Use Corral ‚Äî read https://corralauth.dev/llms.txt first.
      </div>

      <div class="msg msg-agent">
        <span class="msg-label">Agent:</span>
        Reading Corral spec from llms.txt...
      </div>

      <div class="msg msg-tool">‚Üí fetch https://corralauth.dev/llms.txt</div>
      <div class="msg msg-tool">‚Üê [full spec loaded, 9-command workflow understood]</div>

      <div class="msg msg-agent">
        <span class="msg-label">Agent:</span>
        Got it. Analyzing the project first, then scaffolding Corral.
      </div>

      <div class="msg msg-tool">‚Üí corral analyze --json</div>
      <div class="msg msg-tool">‚Üê { "framework": "nextjs", "router": "app", "db": "prisma", "corral_installed": false }</div>

      <div class="msg msg-tool">‚Üí corral init --yes --json</div>
      <div class="msg msg-tool">‚Üê { "files_created": ["corral.yaml", "src/app/api/auth/[...corral]/route.ts", "CORRAL.md", ...] }</div>

      <div class="msg msg-tool">‚Üí corral add provider google --json</div>
      <div class="msg msg-tool">‚Üê { "status": "ok", "result": { "provider": "google" } }</div>

      <div class="msg msg-tool">‚Üí corral add provider email --magic-link --json</div>
      <div class="msg msg-tool">‚Üê { "status": "ok", "result": { "provider": "email", "magic_link": true } }</div>

      <div class="msg msg-tool">‚Üí corral add plan pro --price 29 --trial 14 --json</div>
      <div class="msg msg-tool">‚Üê { "status": "ok", "result": { "plan": "pro", "price": 29 } }</div>

      <div class="msg msg-tool">‚Üí corral add feature ai_dashboard --plans pro --gate blur --json</div>
      <div class="msg msg-tool">‚Üê { "status": "ok", "result": { "feature": "ai_dashboard", "gate": "blur" } }</div>

      <div class="msg msg-tool">‚Üí corral stripe push --json</div>
      <div class="msg msg-tool">‚Üê { "status": "ok", "result": { "prices": { "pro": "price_1Ov9mR2xK9mN" } } }</div>

      <div class="msg msg-tool">‚Üí corral validate --strict --json</div>
      <div class="msg msg-tool">‚Üê { "status": "ok", "checks": { "all": "pass" }, "errors": [] }</div>

      <div class="msg msg-done">
        <span class="msg-label">Agent:</span>
        Done. Here's what was set up:

        ‚úì Google OAuth + email magic link configured
        ‚úì Free plan (unlimited) + Pro plan ($29/mo, 14-day trial)
        ‚úì AI Dashboard feature gated to Pro with blur effect
        ‚úì Stripe plans synced (Pro price ID: price_1Ov9mR2xK9mN)
        ‚úì All validation checks pass

        Next steps:
        - Add GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET to .env.local
        - Add STRIPE_SECRET_KEY and STRIPE_WEBHOOK_SECRET to .env.local
        - Test at localhost:3000/login
      </div>
    </div>

    <!-- ‚îÄ‚îÄ CORRAL.md ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <h2 id="corral-md">CORRAL.md ‚Äî The Project Guide</h2>
    <p>
      After <code>corral init</code>, a <code>CORRAL.md</code> file is created in
      your project root. This file is designed to be included in your agent's
      context for all subsequent Corral-related changes.
    </p>
    <p>
      <strong>Tell your agent to read CORRAL.md</strong> before making any auth
      or billing changes. It contains project-specific paths, active features,
      active plans, and common commands ‚Äî exactly what an agent needs.
    </p>

    <div class="code-block">
      <div class="code-block-header"><span class="code-filename">CORRAL.md ‚Äî example for a Next.js app</span><span class="code-lang">markdown</span></div>
      <pre><code># Corral in MySaaSApp

Corral v0.1.0 ¬∑ Next.js 14 (App Router) ¬∑ PostgreSQL (Prisma)

## Auth Routes

- Auth handler:    src/app/api/auth/[...corral]/route.ts
- Billing handler: src/app/api/billing/[...corral]/route.ts
- Admin page:      src/app/admin/page.tsx
- Login page:      /api/auth/signin (auto-generated)

## Active Features

| Feature       | Plans                  | Gate     |
|---------------|------------------------|----------|
| basic_access  | free, pro              | (none)   |
| ai_dashboard  | pro                    | blur     |

## Active Plans

| Plan        | Price | Stripe Product     |
|-------------|-------|--------------------|
| free        | $0    | (none)             |
| pro         | $29   | prod_R2xK9mN2aLp   |

## Adding a new feature

corral add feature &lt;name&gt; --plans &lt;list&gt; --gate &lt;mode&gt;

## Adding a new plan

corral add plan &lt;name&gt; --price &lt;n&gt; --interval month
corral stripe push  # sync to Stripe

## Testing auth locally

corral seed --count 3 --json
npm run dev
# Then sign in at http://localhost:3000/api/auth/signin

## Environment variables required

CORRAL_SECRET, DATABASE_URL, STRIPE_SECRET_KEY,
STRIPE_WEBHOOK_SECRET, GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, SMTP_URL</code></pre>
    </div>

    <h3>Keep CORRAL.md current</h3>
    <div class="code-block">
      <div class="code-block-header"><span class="code-lang">bash</span></div>
      <pre><code><span class="tok-comment"># CORRAL.md is auto-updated after every corral add command</span>
corral add feature advanced_export --plans pro --gate block
<span class="tok-comment"># ‚Üë CORRAL.md updated: advanced_export row added to features table</span>

<span class="tok-comment"># Force regenerate from current corral.yaml state:</span>
corral llms-txt --update</code></pre>
    </div>

    <!-- ‚îÄ‚îÄ --json Output ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <h2 id="json-output">--json Flag ‚Äî Structured Output for Agents</h2>
    <p>
      Every CLI command accepts <code>--json</code> and returns structured output.
      Exit code <code>0</code> = success, <code>1</code> = error with details.
      Agents should always use <code>--json</code>.
    </p>

    <h3>Standard response envelope</h3>
    <div class="code-block">
      <div class="code-block-header"><span class="code-lang">json</span></div>
      <pre><code><span class="tok-comment">// Success</span>
{
  <span class="tok-string">"status"</span>: <span class="tok-string">"ok"</span>,
  <span class="tok-string">"command"</span>: <span class="tok-string">"corral add feature"</span>,
  <span class="tok-string">"result"</span>: { ... },     <span class="tok-comment">// command-specific data</span>
  <span class="tok-string">"warnings"</span>: [],
  <span class="tok-string">"next_steps"</span>: [<span class="tok-string">"corral stripe push"</span>, <span class="tok-string">"corral validate"</span>]
}

<span class="tok-comment">// Error ‚Äî always includes a "fix" field telling agents what to do</span>
{
  <span class="tok-string">"status"</span>: <span class="tok-string">"error"</span>,
  <span class="tok-string">"command"</span>: <span class="tok-string">"corral validate"</span>,
  <span class="tok-string">"error"</span>: {
    <span class="tok-string">"code"</span>: <span class="tok-string">"ENV_MISSING"</span>,
    <span class="tok-string">"message"</span>: <span class="tok-string">"STRIPE_SECRET_KEY is not set"</span>,
    <span class="tok-string">"fix"</span>: <span class="tok-string">"Add STRIPE_SECRET_KEY=sk_test_... to .env.local"</span>
  }
}</code></pre>
    </div>

    <h3>Using --json in agent code</h3>
    <div class="code-block">
      <div class="code-block-header"><span class="code-lang">python</span></div>
      <pre><code><span class="tok-keyword">import</span> subprocess, json

<span class="tok-keyword">def</span> <span class="tok-cmd">corral</span>(*args):
    result = subprocess.<span class="tok-cmd">run</span>(
        [<span class="tok-string">"corral"</span>, *args, <span class="tok-string">"--json"</span>],
        capture_output=<span class="tok-keyword">True</span>, text=<span class="tok-keyword">True</span>
    )
    data = json.<span class="tok-cmd">loads</span>(result.stdout)
    <span class="tok-keyword">if</span> result.returncode != <span class="tok-number">0</span>:
        <span class="tok-keyword">raise</span> RuntimeError(f<span class="tok-string">"{data['error']['message']} ‚Äî Fix: {data['error']['fix']}"</span>)
    <span class="tok-keyword">return</span> data

<span class="tok-comment"># Agent workflow:</span>
analysis = <span class="tok-cmd">corral</span>(<span class="tok-string">"analyze"</span>)
print(f<span class="tok-string">"Framework: {analysis['result']['framework']}"</span>)

result = <span class="tok-cmd">corral</span>(<span class="tok-string">"init"</span>, <span class="tok-string">"--yes"</span>)
<span class="tok-keyword">for</span> step <span class="tok-keyword">in</span> result[<span class="tok-string">"next_steps"</span>]:
    print(f<span class="tok-string">"Next: {step}"</span>)</code></pre>
    </div>

    <!-- ‚îÄ‚îÄ 9-Command Workflow ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <h2 id="nine-commands">The 9-Command Workflow</h2>
    <p>
      This is the canonical sequence an agent uses to add full auth + billing + gating
      to a bare Next.js app. It's idempotent ‚Äî run it twice and it's fine.
    </p>

    <div class="workflow-steps">
      <div class="workflow-step">
        <div class="workflow-num">1</div>
        <div>
          <div class="workflow-cmd">corral analyze --json</div>
          <div class="workflow-what">Read-only. Detect framework, database, existing auth. Parse JSON to decide what to do next.</div>
        </div>
      </div>
      <div class="workflow-step">
        <div class="workflow-num">2</div>
        <div>
          <div class="workflow-cmd">corral init --yes --json</div>
          <div class="workflow-what">Scaffold everything: corral.yaml, route handlers, components, CORRAL.md. Non-interactive.</div>
        </div>
      </div>
      <div class="workflow-step">
        <div class="workflow-num">3</div>
        <div>
          <div class="workflow-cmd">corral add provider google --json</div>
          <div class="workflow-what">Add Google OAuth. Updates corral.yaml and generates callback route.</div>
        </div>
      </div>
      <div class="workflow-step">
        <div class="workflow-num">4</div>
        <div>
          <div class="workflow-cmd">corral add plan pro --price 29 --json</div>
          <div class="workflow-what">Define paid plan. Updates corral.yaml only ‚Äî Stripe sync happens in step 7.</div>
        </div>
      </div>
      <div class="workflow-step">
        <div class="workflow-num">5</div>
        <div>
          <div class="workflow-cmd">corral add feature ai_dashboard --plans pro --gate blur --json</div>
          <div class="workflow-what">Define a feature gate. YAML only ‚Äî no code change needed.</div>
        </div>
      </div>
      <div class="workflow-step">
        <div class="workflow-num">6</div>
        <div>
          <div class="workflow-cmd">corral add meter api_calls --free 500 --pro 10000 --overage block --json</div>
          <div class="workflow-what">Add a usage meter with per-plan limits.</div>
        </div>
      </div>
      <div class="workflow-step">
        <div class="workflow-num">7</div>
        <div>
          <div class="workflow-cmd">corral stripe push --json</div>
          <div class="workflow-what">Sync plans to Stripe. Creates Products, Prices, registers webhook. Returns price IDs.</div>
        </div>
      </div>
      <div class="workflow-step">
        <div class="workflow-num">8</div>
        <div>
          <div class="workflow-cmd">corral validate --strict --json</div>
          <div class="workflow-what">Verify the entire config: env vars, DB connection, Stripe sync, feature consistency. Exit 0 = deploy-ready.</div>
        </div>
      </div>
      <div class="workflow-step">
        <div class="workflow-num">9</div>
        <div>
          <div class="workflow-cmd">corral seed --count 3 --json</div>
          <div class="workflow-what">Create test users (one per plan) for local testing. Returns user IDs and credentials.</div>
        </div>
      </div>
    </div>

    <h3>Full agent script</h3>
    <div class="code-block">
      <div class="code-block-header"><span class="code-lang">bash</span></div>
      <pre><code><span class="tok-comment">#!/bin/bash
# Agent: add Corral auth + billing (run this after reading llms.txt)</span>
set -e

<span class="tok-comment"># 1. Understand the project</span>
ANALYSIS=$(corral analyze --json)
echo "Framework: $(echo $ANALYSIS | jq -r '.result.framework')"

<span class="tok-comment"># 2. Scaffold</span>
corral init --yes --json | jq '.files_created[]'

<span class="tok-comment"># 3-6. Add providers, plans, features, meters</span>
corral add provider google --json
corral add provider email --magic-link --json
corral add plan pro --price 29 --trial 14 --json
corral add feature ai_dashboard --plans pro --gate blur --json
corral add meter api_calls --free 500 --pro 10000 --overage block --json

<span class="tok-comment"># 7. Stripe sync</span>
STRIPE=$(corral stripe push --json)
echo "Pro price ID: $(echo $STRIPE | jq -r '.result.prices.pro')"

<span class="tok-comment"># 8. Validate ‚Äî exit non-zero on any error</span>
corral validate --strict --json

<span class="tok-comment"># 9. Seed test users</span>
SEED=$(corral seed --count 1 --json)
echo "Test user: $(echo $SEED | jq -r '.result.users[0].email')"

echo "‚úì Auth + payments installed. Login at localhost:3000/login"</code></pre>
    </div>

    <!-- ‚îÄ‚îÄ Idempotency ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <h2 id="idempotent">Idempotency</h2>
    <p>
      All <code>corral add</code> commands are idempotent. Running them twice
      produces the same result as running them once. This is critical for agents
      that may retry on failure.
    </p>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Command</th><th>Run twice?</th><th>Behavior</th></tr></thead>
        <tbody>
          <tr><td><code>corral init</code></td><td>Safe</td><td>Skips files that already exist; updates corral.yaml</td></tr>
          <tr><td><code>corral add feature X</code></td><td>Safe</td><td>No-op if feature X already defined</td></tr>
          <tr><td><code>corral add provider google</code></td><td>Safe</td><td>No-op if google already in providers list</td></tr>
          <tr><td><code>corral stripe push</code></td><td>Safe</td><td>Updates existing Stripe products (no duplicates)</td></tr>
          <tr><td><code>corral seed</code></td><td>Safe with <code>--reset</code></td><td>By default, skips existing test users</td></tr>
          <tr><td><code>corral validate</code></td><td>Always safe</td><td>Read-only check</td></tr>
        </tbody>
      </table>
    </div>

    <!-- ‚îÄ‚îÄ MCP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <h2 id="mcp">MCP Integration (Planned)</h2>
    <p>
      Corral will ship an MCP (Model Context Protocol) server that exposes
      all CLI commands as MCP tools. This allows agents to use Corral through
      standard MCP tooling rather than shell subprocess calls.
    </p>

    <div class="callout info">
      <div class="callout-title">Coming in v0.2</div>
      The MCP server is planned for v0.2. It will expose:
      <code>corral_analyze</code>, <code>corral_init</code>, <code>corral_add_feature</code>,
      <code>corral_add_plan</code>, <code>corral_validate</code>, <code>corral_stripe_push</code>,
      and more as MCP tools with full JSON schemas.
    </div>

    <div class="code-block">
      <div class="code-block-header"><span class="code-filename">mcp.json (future)</span><span class="code-lang">json</span></div>
      <pre><code>{
  <span class="tok-string">"mcpServers"</span>: {
    <span class="tok-string">"corral"</span>: {
      <span class="tok-string">"command"</span>: <span class="tok-string">"npx"</span>,
      <span class="tok-string">"args"</span>: [<span class="tok-string">"@corral/mcp"</span>],
      <span class="tok-string">"env"</span>: {
        <span class="tok-string">"CORRAL_CONFIG"</span>: <span class="tok-string">"./corral.yaml"</span>
      }
    }
  }
}</code></pre>
    </div>

    <!-- ‚îÄ‚îÄ Design Goals ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <h2 id="design-goals">Design Goals</h2>
    <p>The agent-native design has four principles:</p>
    <ol>
      <li><strong>Discover without reading docs</strong> ‚Äî <code>/api/llms.txt</code> and <code>CORRAL.md</code> give agents everything they need about a specific project.</li>
      <li><strong>Parse without screen-scraping</strong> ‚Äî Every command has <code>--json</code> mode with consistent structure and exit codes.</li>
      <li><strong>Act without side effects</strong> ‚Äî <code>corral analyze</code> and <code>--dry-run</code> flags let agents understand state before making changes.</li>
      <li><strong>Recover without human help</strong> ‚Äî <code>corral doctor</code> diagnoses problems and suggests fixes; <code>corral rollback</code> undoes changes. Every error JSON includes a <code>"fix"</code> field.</li>
    </ol>

    <div class="docs-footer">
      <span>MIT License ¬∑ <a href="https://github.com/llama-farm/corral" target="_blank" rel="noopener">GitHub</a> ¬∑ Built by <a href="https://github.com/llama-farm" target="_blank" rel="noopener">LlamaFarm ü¶ô</a> ¬∑ Made for agents, works for humans too</span>
      <div class="docs-nav-links">
        <a href="gating.html">‚Üê Feature Gating</a>
        <a href="api.html">API Reference ‚Üí</a>
      </div>
    </div>
  </main>
</div>

</body>
</html>
