// {{APP_NAME}} â€” Auth & Plan Gates (generated by Corral)
// Use these to protect pages and features based on auth state and plan.
//
// <AuthGate>             â€” requires login
// <PlanGate plan="pro">  â€” requires specific plan
// <BlurGate plan="pro">  â€” shows blurred content with upgrade overlay

import React from "react";
import { useAuth } from "./auth-context";

// â”€â”€â”€ Auth Gate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Blocks content unless user is logged in.
export function AuthGate({
  children,
  fallback,
}: {
  children: React.ReactNode;
  fallback?: React.ReactNode;
}) {
  const { user, loading } = useAuth();
  if (loading) return <div style={{ textAlign: "center", padding: "2rem", color: "#888" }}>Loading...</div>;
  if (!user) return <>{fallback || <AuthFallback />}</>;
  return <>{children}</>;
}

// â”€â”€â”€ Plan Gate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Blocks content unless user has the required plan (or higher).
const PLAN_RANK: Record<string, number> = { free: 0, pro: 1, team: 2, enterprise: 3 };

export function PlanGate({
  plan,
  children,
  fallback,
}: {
  plan: string;
  children: React.ReactNode;
  fallback?: React.ReactNode;
}) {
  const { user, loading } = useAuth();
  if (loading) return <div style={{ textAlign: "center", padding: "2rem", color: "#888" }}>Loading...</div>;
  if (!user) return <AuthFallback />;

  const userRank = PLAN_RANK[user.plan] ?? 0;
  const requiredRank = PLAN_RANK[plan] ?? 1;
  if (userRank < requiredRank) return <>{fallback || <PlanFallback required={plan} current={user.plan} />}</>;
  return <>{children}</>;
}

// â”€â”€â”€ Blur Gate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Shows content behind a frosted glass blur with upgrade overlay.
export function BlurGate({
  plan,
  children,
}: {
  plan: string;
  children: React.ReactNode;
}) {
  const { user } = useAuth();
  const userRank = PLAN_RANK[user?.plan || "free"] ?? 0;
  const requiredRank = PLAN_RANK[plan] ?? 1;
  const locked = !user || userRank < requiredRank;

  return (
    <div style={{ position: "relative" }}>
      <div style={locked ? { filter: "blur(8px)", pointerEvents: "none", userSelect: "none" } : {}}>
        {children}
      </div>
      {locked && (
        <div style={{
          position: "absolute", inset: 0, display: "flex", alignItems: "center",
          justifyContent: "center", background: "rgba(0,0,0,0.4)", borderRadius: "12px",
        }}>
          <div style={{ textAlign: "center", padding: "2rem" }}>
            <h3>ðŸ”’ {plan.charAt(0).toUpperCase() + plan.slice(1)} Feature</h3>
            <p>Upgrade to {plan} to unlock this content.</p>
          </div>
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€ Default Fallbacks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AuthFallback() {
  return (
    <div style={{ textAlign: "center", padding: "3rem 2rem" }}>
      <h2>Sign in to continue</h2>
      <p style={{ color: "#888", margin: "0.5rem 0 1.5rem" }}>
        Create a free account to access this feature.
      </p>
    </div>
  );
}

function PlanFallback({ required, current }: { required: string; current: string }) {
  return (
    <div style={{ textAlign: "center", padding: "3rem 2rem" }}>
      <h2>ðŸ”’ {required.charAt(0).toUpperCase() + required.slice(1)} Plan Required</h2>
      <p style={{ color: "#888", margin: "0.5rem 0 1.5rem" }}>
        You're on the <strong>{current}</strong> plan. Upgrade to <strong>{required}</strong> to unlock this.
      </p>
    </div>
  );
}
